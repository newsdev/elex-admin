{% extends "base.html" %}

{% block content %}
<h1>{{ race }}</h1>

<hr>

<div class="row">
    <div class="col-md-3">
        <h3>Accept AP calls</h3>
    </div>
    <div class="col-md-1">
        <input type="checkbox" {% if race.accept_ap_calls %}checked {% endif%}data-toggle="toggle" data-onstyle="success">
    </div>
</div>

<hr>

{% if candidates %}
<h3>Candidates</h3>
<table class="table">
    <tr>
        <th>NYT Name</th>
        <th>NYT Description</th>
        <th></th>
    </tr>
{% for c in candidates %}
    <tr id="candidate-{{ c.candidateid }}">
        <td><input class="form-control candidate-name" name="nyt_candidate_name" value="{{ c }}"></td>
        <td><input class="form-control candidate-description" name="nyt_candidate_description" value="{% if nyt_candidate_description %}{{ c.nyt_candidate_description }}{% endif %}"></td>
        <td><input type="button" class="btn btn-small btn-success" value="Save" data-candidateid="{{ c.candidateid }}"></td>
    </tr>
{% endfor %}
</table>
{% endif %}

{% endblock %}

{% block extrajs %}
<script type="text/javascript">
    var submit_candidate = function(data){
        var candidate_id = $(this).attr('data-candidateid');
        var data = {}
        data['nyt_candidate_name'] = $('#candidate-' + candidate_id + ' input.candidate-name').val();
        data['nyt_candidate_description'] = $('#candidate-' + candidate_id + ' input.candidate-description').val();
        $.ajax({
          type: "POST",
          url: '/elex/candidate/' + candidate_id + '/',
          data: data,
          success: function(response){
            console.log(response);
          },
          dataType: 'JSON'
        });
    };

    $('input.btn').on('click', submit_candidate);
</script>
{% endblock %}